<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Blank</title>

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="css/sb-admin-2.min.css" rel="stylesheet">
  <link href="css/custom-checkbox.css" rel="stylesheet">
  <link href="css/simple-lists.css" rel="stylesheet">

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin-2.min.js"></script>
</head>

<body id="page-top" style="display: none">
  <script src="js/cost-center-generators.js"></script>
  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar"></ul>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow" id="topbar">
        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid" style="max-width: 20cm;">

          <!-- Page Heading -->
          <h1 class="h3 mb-4 text-gray-800">Add Cost-Center</h1>

          <!-- Details Card -->
          <div class="card shadow">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between text-primary">
              <h6 class="m-0 font-weight-bold">Details</h6>
              <i class="fas fa-pen"></i>
            </div>
            <div class="card-body">
              <!-- Title -->
              <div class="form-group row">
                <div class="col-sm-3 p-1">
                  <h6>Title:</h6>
                </div>
                <div class="col p-1">
                  <input class="form-control" placeholder="Enter title.." id="ccTitle" oninput="onTitleChange()">
                </div>
              </div>
              <!-- Description -->
              <div class="form-group row mb-0">
                <div class="col-sm-3 p-1">
                  <h6>Description:</h6>
                </div>
                <div class="col p-1">
                  <textarea class="form-control" placeholder="Enter description.." id="ccDescription"
                    oninput="onDescriptionChange()"></textarea>
                </div>
              </div>
              <script type="text/javascript">
                function onTitleChange() {
                  costCenter.title = document.getElementById("ccTitle").value;
                }
                function onDescriptionChange() {
                  costCenter.description = document.getElementById("ccDescription").value;
                }
              </script>
            </div>
          </div>

          <br>

          <!-- Parent CC Card -->
          <div class="card shadow">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between text-primary">
              <h6 class="m-0 font-weight-bold">Parent</h6>
              <i class="fas fa-user"></i>
            </div>

            <!-- Card Body-->
            <div class="p-4">
              <div style="max-height: 5cm;">
                <ul class="simple-list m-0 py-2 px-1" id="costCentersList">
                  <li class="inputGroup li-separator">
                    <input id="independent_radioBtn" name="costCenterRadio" type="radio" checked
                      oninput="onCostCenterRadioBtn()">
                    <label for="independent_radioBtn">Independent</label>
                  </li>
                </ul>
              </div>
            </div>

          </div>

          <br>

          <!-- Owners Card -->
          <div class="card shadow">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between text-primary">
              <h6 class="m-0 font-weight-bold">Owners</h6>
              <i class="fas fa-user"></i>
            </div>

            <!-- Card Body-->
            <div class="p-4">
              <ul class="simple-list m-0 p-1" id="ownersList" style="max-height: 5cm;"></ul>
            </div>
          </div>

          <br>

          <div class="card shadow">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between text-white"
              style="background-color: #4e73df;">
              <h6 class="m-0 font-weight-bold">Finish</h6>
              <i class="fas fa-check"></i>
            </div>
            <div class="p-4">
              <div class="text">Here you will recive error messages</div>
              <a class="btn btn-primary text-white mt-4" style="width: 100%;" onclick="saveToDatabase()">
                <span class="text">Submit</span>
              </a>
            </div>
          </div>
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright Â© Your Website 2019</span>
            </div>
          </div>
        </footer>
        <!-- End of Footer -->

      </div>

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top" style="display: none;">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true"></div>


    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="/__/firebase/7.15.1/firebase-app.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="/__/firebase/7.15.1/firebase-analytics.js"></script>
    <script src="/__/firebase/7.15.1/firebase-auth.js"></script>
    <script src="/__/firebase/7.15.1/firebase-database.js"></script>
    <!-- Initialize Firebase -->
    <script src="/__/firebase/init.js"></script>

    <script src="vendor/jquery/jquery.min.js"></script>

    <!-- Load Shared Content -->
    <script src="js/shared-content.js"></script>



    <!-- role & authentication based content -->
    <script src="js/pagecontent-auth-role.js"></script>
    <script src="js/uuid-generator.js"></script>


    <script>
      var allOwners = [];
      var allCostCenters = [];
      var db = firebase.database();
      db.ref('owners').once('value', (snapshot) => {
        if (snapshot.exists()) {
          var ownersList = document.getElementById('ownersList');
          snapshot.forEach((childSnapshot) => {
            var owner = childSnapshot.val();
            owner.id = childSnapshot.key;
            allOwners.push(owner);
            var chekcbox = `
              <li class="inputGroup li-separator">
                <input id="${owner.id}_checkbox" name="ownerCheckbox" type="checkbox" oninput="onOwnerCheckbox()">
                <label for="${owner.id}_checkbox">${owner.name} - ${owner.flatNumber}</label>
              </li>
              `;
            ownersList.innerHTML += chekcbox;
          });
        }
      });
      firebase.database().ref('costCenters').once('value', (snapshot) => {
        if (snapshot.exists()) {
          snapshot.forEach((childSnapshot) => {
            var fullDataCC = childSnapshot.val();
            fullDataCC.id = childSnapshot.key;
            allCostCenters.push(fullDataCC);


          });
          var costCentersList = document.getElementById('costCentersList');
          allCostCenters.forEach((costCenter) => {
            var radioBtn = `
              <li class="inputGroup li-separator">
                <input id="${costCenter.id}_radioBtn" name="costCenterRadio" type="radio" oninput="onCostCenterRadioBtn()">
                <label for="${costCenter.id}_radioBtn">${costCenter.title}</label>
              </li>
            `;
            costCentersList.innerHTML += radioBtn;

          });

        }
      });
      var costCenter = {
        title: 'untitled',
        description: 'no description',
        owners: [],
        parentId: '',
      };
      function onOwnerCheckbox() {
        var checkboxes = document.getElementsByName('ownerCheckbox');
        costCenter.owners = [];
        checkboxes.forEach((checkbox) => {
          if (checkbox.checked) {
            var ownerId = checkbox.id.replace('_checkbox', '');
            costCenter.owners.push(ownerId);
          }
        });
      }
      function onCostCenterRadioBtn() {
        var radioBtns = document.getElementsByName('costCenterRadio');
        radioBtns.forEach((btn) => {
          if (btn.checked) {
            var id = btn.id.replace('_radioBtn', '');
            costCenter.parentId = id == 'independent' ? '' : id;
            console.log(id + ' ' + btn.checked);
          }
        });
      }
      function saveToDatabase() {

        // generate meta data
        var timestamp = new Date().getTime();
        costCenter.timestamp = timestamp;
        // generate id
        var uid = generateUUID();
        // push to database
        firebase.database().ref('costCenters/' + uid).set(costCenter).then((result) => {
          window.location = "index.html";
        }).catch((e) => {
          console.error(e);
        });
      }
    </script>
</body>

</html>